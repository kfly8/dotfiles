#!/bin/bash

# ファイルをコピー（存在する場合のみ）
copy_if_exists() {
    local src="$ORIGINAL_PATH/$1"
    local dest="$WORKTREE_PATH/$1"
    if [ -f "$src" ]; then
        mkdir -p "$(dirname "$dest")"
        cp "$src" "$dest"
    fi
}

# ディレクトリをコピー（存在する場合のみ）
copy_dir_if_exists() {
    local src="$ORIGINAL_PATH/$1"
    local dest="$WORKTREE_PATH/$1"
    if [ -d "$src" ]; then
        echo "Copying $1..."
        cp -r "$src" "$dest"
    fi
}

# ファイルの複製
copy_if_exists ".envrc"
copy_if_exists ".dev.vars"
copy_if_exists ".claude/settings.local.json"
copy_if_exists "CLAUDE.local.md"
copy_if_exists "local.db"
copy_if_exists "docker-compose.override.yml"

# ディレクトリの複製
mkdir -p "$WORKTREE_PATH/tmp/claude/"
copy_dir_if_exists "tmp/claude/plans"

# direnv allow（.envrcが存在する場合のみ）
[ -f "$WORKTREE_PATH/.envrc" ] && direnv allow "$WORKTREE_PATH"

# mise trust（mise.tomlが存在する場合のみ）
[ -f "$WORKTREE_PATH/mise.toml" ] && mise trust "$WORKTREE_PATH"

echo "Finished post-hook"
